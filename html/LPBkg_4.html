<div class="container">

<table style="width: 100%;"><tr>
<td>dhatL2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>CD-plot and adjusted deviance test</h2>

<h3>Description</h3>

<p>Construction of CD-plot and adjusted deviance test. The confidence bands are also adjusted for post-selection inference.
</p>


<h3>Usage</h3>

<pre><code class="language-R">dhatL2(data, g, M = 6, Mmax = NULL, smooth = TRUE,
  criterion = "AIC", hist.u = TRUE, breaks = 20, ylim = c(0, 2.5),
  range = c(min(data),max(data)), sigma = 2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A vector of data. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g</code></td>
<td>
<p>The postulated model from which we want to assess if deviations occur.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>The desired size of the polynomial basis to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mmax</code></td>
<td>
<p>The maximum size of the polynomial basis from which <code>M</code> was selected (the default is <code>20</code>). See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>A logical argument indicating if a denoised solution should be implemented. The default is <code>FALSE</code>, meaning that the full solution should be implemented. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>If <code>smooth=TRUE</code>, the criterion with respect to which the denoising process should be implemented. The two possibilities are <code>"AIC"</code> or <code>"BIC"</code>. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hist.u</code></td>
<td>
<p>A logical argument indicating if the CD-plot should be displayed or not. The default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>If <code>hist.u=TRUE</code>, the number of breaks of the CD-plot. The default is <code>20</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>If <code>hist.u=TRUE</code>, the range of the y-axis of the CD-plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range</code></td>
<td>
<p>Range of the data/search region considered. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>The significance level (in sigmas) with respect to which the confidence bands should be constructed. See details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The argument <code>data</code> collects the data for which we want to test if its distribution deviates from the one of the postulated model specified in the argument <code>g</code>. In Algeri, 2019, the sample specified under <code>data</code> corresponds to the source-free sample in the background calibration phase and to the physics sample in the signal search phase.
The value <code>M</code> selected determines the smoothness of the estimated comparison density, with smaller values of <code>M</code> leading to smoother estimates. The deviance test is used to select the value <code>M</code> which leads to the most significant deviation from the postulated model. The default value for <code>Mmax</code> is set to <code>20</code>. Notice that numerical issues may
arise for larger values of <code>Mmax</code>.
If <code>smooth=TRUE</code> the largest coefficient estimates are selected according to either the AIC or BIC criterion as described in Algeri, 2019 and Mukhopadhyay, 2017.
If <code>Mmax&gt;1</code> and/or <code>smooth=TRUE</code>, post-selection Bonferroni's correction is automatically implemented to both the deviance test p-value and the confidence bands. The desired level of significance can be expressed as one minus the cdf of a standard normal evaluated at <code>sigma</code> (see Algeri, 2019).
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Deviance</code></td>
<td>
<p>Value of the deviance test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dev_pvalue</code></td>
<td>
<p>Unadjusted p-value of the deviance test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Dev_adj_pvalue</code></td>
<td>
<p>Post-selection Bonferroni adjusted p-value of the deviance test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kstar</code></td>
<td>
<p>Number of coefficients selected by the denoising process. If <code>smooth=FALSE</code>, <code>kstar=M</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dhat</code></td>
<td>
<p>Function corresponding to the estimated comparison density in the u domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dhat.x</code></td>
<td>
<p>Function corresponding to the estimated comparison density in the x domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SE</code></td>
<td>
<p>Function corresponding to the estimated standard errors of the comparison density in the u domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LBf1</code></td>
<td>
<p>Function corresponding to the lower bound of the confidence bands under  in u domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>UBf1</code></td>
<td>
<p>Function corresponding to the upper bound of the confidence bands in u domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>Function corresponding to the estimated density of the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>Vector of values corresponding to the cdf of the model specified in <code>g</code> evaluated at the vector <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LP</code></td>
<td>
<p>Estimates of the coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>
<p>Cumulative density function of the postulated model specified in the argument <code>g</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Sara Algeri</p>


<h3>References</h3>

<p>S. Algeri, 2019. Detecting new signals under background mismodelling.	&lt;arXiv:1906.06615&gt;.
</p>
<p>S. Mukhopadhyay, 2017. Large-scale mode identification and data-driven sciences. Electronic Journal of Statistics 11 (2017), no. 1, 215â€“240.
</p>


<h3>See Also</h3>

<p><code>Legj</code>,<code>BestM</code>,<code>denoise</code>.</p>


<h3>Examples</h3>

<pre><code class="language-R">#generaing data
x&lt;-rnorm(1000,10,7)
xx&lt;-x[x&gt;=10 &amp; x&lt;=20]

#create suitable postulated quantile function of data
G&lt;-pnorm(20,5,15)-pnorm(10,5,15)
g&lt;-function(x){dnorm(x,5,15)/G}

#Choose best M
Mmax=20
range=c(10,20)
m&lt;-BestM(data=xx,g, Mmax,range)

# vectorize postulated quantile function
g&lt;-Vectorize(g)
u&lt;-g(xx)

#M has to be sufficient big, otherwise dhatL2 function will crush.
#So,here we set m eqaul 6 as an example
m&lt;-6
comp.density&lt;-dhatL2(data=xx,g, M=m, Mmax=Mmax,smooth=FALSE,criterion="AIC",hist.u=TRUE,breaks=20,
         ylim=c(0,2.5),range=range,sigma=2)
</code></pre>


</div>