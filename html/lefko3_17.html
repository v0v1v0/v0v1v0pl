<div class="container">

<table style="width: 100%;"><tr>
<td>density_input</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Set Density Dependence Relationships in Matrix Elements</h2>

<h3>Description</h3>

<p>Function <code>density_input()</code> provides all necessary data to incorporate
density dependence into a <code>lefkoMat</code> object, a list of matrices, or a
single matrix. Four forms of density dependence are allowed, including the
Ricker function, the Beverton-Holt function, the Usher function, and the
logistic function. In each case, density must have an effect with a delay of
at least one time-step (see Notes). The resulting data frame provides a
guide for other <code>lefko3</code> functions to modify matrix elements by
density.
</p>


<h3>Usage</h3>

<pre><code class="language-R">density_input(
  mpm,
  stage3 = NULL,
  stage2 = NULL,
  stage1 = NULL,
  age2 = NULL,
  style = NULL,
  time_delay = NULL,
  alpha = NULL,
  beta = NULL,
  type = NULL,
  type_t12 = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mpm</code></td>
<td>
<p>The <code>lefkoMat</code> object that will be subject to density
dependent projection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage3</code></td>
<td>
<p>A vector showing the name or number of the stage in occasion
<em>t</em>+1 in the transitions to be affected by density. Abbreviations for
groups of stages are also usable (see Notes).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage2</code></td>
<td>
<p>A vector showing the name or number of the stage in occasion
<em>t</em> in the transition to be affected by density. Abbreviations for
groups of stages are also usable (see Notes).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage1</code></td>
<td>
<p>A vector showing the name or number of the stage in occasion
<em>t</em>-1 in the transition to be affected by density. Only needed if a
historical MPM is used. Abbreviations for groups of stages are also usable
(see Notes).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age2</code></td>
<td>
<p>A vector showing the age of the stage in occasion <em>t</em> in the
transition to be affected by density. Only needed if an age-by-stage MPM is
used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>style</code></td>
<td>
<p>A vector coding for the style of density dependence on each
transition subject to density dependence. Options include <code>1</code>,
<code>ricker</code>, <code>ric</code>, or <code>r</code> for the Ricker function; <code>2</code>,
<code>beverton</code>, <code>bev</code>, and <code>b</code> for the Beverton-Holt function;
<code>3</code>, <code>usher</code>, <code>ush</code>, and <code>u</code> for the Usher function; and
<code>4</code>, <code>logistic</code>, <code>log</code>, and <code>l</code> for the logistic
function. If only a single code is provided, then all noted transitions are
assumed to be subject to this style of density dependence. Defaults to
<code>ricker</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_delay</code></td>
<td>
<p>An integer vector indicating the number of occasions back
on which density dependence operates. Defaults to <code>1</code>, and may not equal
any integer less than 1. If a single number is input, then all noted
transitions are assumed to be subject to this time delay.  Defaults to
<code>1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A vector indicating the numeric values to use as the
alpha term in the two parameter Ricker, Beverton-Holt, or Usher function, or
the value of the carrying capacity <em>K</em> to use in the logistic equation
(see <code>Notes</code> section for more on this term). If a single number is
provided, then all noted transitions are assumed to be subject to this value
of alpha. Defaults to <code>1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>A vector indicating the numeric values to use as the beta term in
the two parameter Ricker, Beverton-Holt, or Usher function. Used to indicate
whether to use <em>K</em> as a hard limit in the logistic equation (see section
<code>Notes</code> below). If a single number is provided, then all noted
transitions are assumed to be subject to this value of <code>beta</code>. Defaults
to <code>1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A vector denoting the kind of transition between occasions
<em>t</em> and <em>t</em>+1 to be replaced. This should be entered as <code>1</code>,
<code>S</code>, or <code>s</code> for the replacement of a survival transition; or 
<code>2</code>, <code>F</code>, or <code>f</code> for the replacement of a fecundity
transition. If empty or not provided, then defaults to <code>1</code> for survival
transition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type_t12</code></td>
<td>
<p>An optional vector denoting the kind of transition between
occasions <em>t</em>-1 and <em>t</em>. Only necessary if a historical MPM in
deVries format is desired. This should be entered as <code>1</code>, <code>S</code>, or
<code>s</code> for a survival transition; or <code>2</code>, <code>F</code>, or <code>f</code> for a
fecundity transitions. Defaults to <code>1</code> for survival transition, with
impacts only on the construction of deVries-format hMPMs.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame of class <code>lefkoDens</code>. This object can be used as
input in function <code>projection3()</code>.
</p>
<p>Variables in this object include the following:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>stage3</code></td>
<td>
<p>Stage at occasion <em>t</em>+1 in the transition to be replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage2</code></td>
<td>
<p>Stage at occasion <em>t</em> in the transition to be replaced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage1</code></td>
<td>
<p>Stage at occasion <em>t</em>-1 in the transition to be replaced,
if applicable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age2</code></td>
<td>
<p>Age at occasion <em>t</em> in the transition to be replaced, if
applicable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>style</code></td>
<td>
<p>Style of density dependence, coded as 1, 2, 3, or 4 for the
Ricker, Beverton-Holt, Usher, or logistic function, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_delay</code></td>
<td>
<p>The time delay on density dependence, in time steps.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The value of alpha in the Ricker, Beverton-Holt, or Usher
function, or the value of carrying capacity, <em>K</em>, in the logistic
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>The value of beta in the Ricker, Beverton-Holt, or Usher
function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Designates whether the transition from occasion <em>t</em> to
occasion <em>t</em>+1 is a survival transition probability (1), or a fecundity
rate (2).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type_t12</code></td>
<td>
<p>Designates whether the transition from occasion <em>t</em>-1 to
occasion <em>t</em> is a survival transition probability (1), a fecundity rate
(2).</p>
</td>
</tr>
</table>
<h3>Notes</h3>

<p>This function provides inputs when density dependence is operationalized
directly on matrix elements. It can be used in both <code>projection3()</code> and
<code>f_projection3()</code>. Users wishing to modify vital rate functions by
density dependence functions for use in function-based projections with
function <code>f_projection3()</code> should use function <code>density_vr()</code> to
provide the correct inputs.
</p>
<p>The parameters <code>alpha</code> and <code>beta</code> are applied according to the
two-parameter Ricker function, the two-parameter Beverton-Holt function, the
two-parameter Usher function, or the one-parameter logistic function.
Although the default is that a 1 time step delay is assumed, greater time
delays can be set through the <code>time_delay</code> option.
</p>
<p>Entries in <code>stage3</code>, <code>stage2</code>, and <code>stage1</code> can include
abbreviations for groups of stages. Use <code>rep</code> if all reproductive stages
are to be used, <code>nrep</code> if all mature but non-reproductive stages are to
be used, <code>mat</code> if all mature stages are to be used, <code>immat</code> if all
immature stages are to be used, <code>prop</code> if all propagule stages are to be
used, <code>npr</code> if all non-propagule stages are to be used, <code>obs</code> if
all observable stages are to be used, <code>nobs</code> if all unobservable stages
are to be used, and leave empty or use <code>all</code> if all stages in stageframe
are to be used.
</p>
<p>When using the logistic function, it is possible that the time delay used in
density dependent simulations will cause matrix elements to become negative.
To prevent this behavior, set the associated <code>beta</code> term to <code>1.0</code>.
Doing so will set <code>K</code> as the hard limit in the logistic equation,
essentially setting a minimum limit at <code>0</code> for all matrix elements
modified.
</p>


<h3>See Also</h3>

<p><code>start_input()</code>
</p>
<p><code>projection3()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(lathyrus)

sizevector &lt;- c(0, 100, 13, 127, 3730, 3800, 0)
stagevector &lt;- c("Sd", "Sdl", "VSm", "Sm", "VLa", "Flo", "Dorm")
repvector &lt;- c(0, 0, 0, 0, 0, 1, 0)
obsvector &lt;- c(0, 1, 1, 1, 1, 1, 0)
matvector &lt;- c(0, 0, 1, 1, 1, 1, 1)
immvector &lt;- c(1, 1, 0, 0, 0, 0, 0)
propvector &lt;- c(1, 0, 0, 0, 0, 0, 0)
indataset &lt;- c(0, 1, 1, 1, 1, 1, 1)
binvec &lt;- c(0, 100, 11, 103, 3500, 3800, 0.5)

lathframe &lt;- sf_create(sizes = sizevector, stagenames = stagevector,
  repstatus = repvector, obsstatus = obsvector, matstatus = matvector,
  immstatus = immvector, indataset = indataset, binhalfwidth = binvec,
  propstatus = propvector)

lathvert &lt;- verticalize3(lathyrus, noyears = 4, firstyear = 1988,
  patchidcol = "SUBPLOT", individcol = "GENET", blocksize = 9,
  juvcol = "Seedling1988", sizeacol = "Volume88", repstracol = "FCODE88",
  fecacol = "Intactseed88", deadacol = "Dead1988",
  nonobsacol = "Dormant1988", stageassign = lathframe, stagesize = "sizea",
  censorcol = "Missing1988", censorkeep = NA, censor = TRUE)

lathsupp3 &lt;- supplemental(stage3 = c("Sd", "Sd", "Sdl", "Sdl", "Sd", "Sdl", "mat"),
  stage2 = c("Sd", "Sd", "Sd", "Sd", "rep", "rep", "Sdl"),
  stage1 = c("Sd", "rep", "Sd", "rep", "npr", "npr", "Sd"),
  eststage3 = c(NA, NA, NA, NA, NA, NA, "mat"),
  eststage2 = c(NA, NA, NA, NA, NA, NA, "Sdl"),
  eststage1 = c(NA, NA, NA, NA, NA, NA, "NotAlive"),
  givenrate = c(0.345, 0.345, 0.054, 0.054, NA, NA, NA),
  multiplier = c(NA, NA, NA, NA, 0.345, 0.054, NA),
  type = c(1, 1, 1, 1, 3, 3, 1), type_t12 = c(1, 2, 1, 2, 1, 1, 1),
  stageframe = lathframe, historical = TRUE)

ehrlen3 &lt;- rlefko3(data = lathvert, stageframe = lathframe, year = "all", 
  stages = c("stage3", "stage2", "stage1"), supplement = lathsupp3,
  yearcol = "year2", indivcol = "individ")

ehrlen3mean &lt;- lmean(ehrlen3)

e3d &lt;- density_input(ehrlen3mean, stage3 = c("Sd", "Sdl"),
  stage2 = c("rep", "rep"), stage1 = c("all", "all"), style = 1,
  time_delay = 1, alpha = 1, beta = 0, type = c(2, 2), type_t12 = c(1, 1))

lathproj &lt;- projection3(ehrlen3, nreps = 5, stochastic = TRUE, substoch = 2,
  density = e3d)


</code></pre>


</div>