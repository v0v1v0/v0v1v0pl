<div class="container">

<table style="width: 100%;"><tr>
<td>addMinicharts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add or update charts on a leaflet map</h2>

<h3>Description</h3>

<p>these functions add or update minicharts in a leaflet map at given coordinates:
they can be bar charts, pie charts or polar charts where chartdata is encoded
either by area or by radius.
</p>


<h3>Usage</h3>

<pre><code class="language-R">addMinicharts(
  map,
  lng,
  lat,
  chartdata = 1,
  time = NULL,
  maxValues = NULL,
  type = "auto",
  fillColor = d3.schemeCategory10[1],
  colorPalette = d3.schemeCategory10,
  width = 30,
  height = 30,
  opacity = 1,
  showLabels = FALSE,
  labelText = NULL,
  labelMinSize = 8,
  labelMaxSize = 24,
  labelStyle = NULL,
  transitionTime = 750,
  popup = popupArgs(),
  layerId = NULL,
  legend = TRUE,
  legendPosition = "topright",
  timeFormat = NULL,
  initialTime = NULL,
  onChange = NULL,
  popupOptions = NULL
)

updateMinicharts(
  map,
  layerId,
  chartdata = NULL,
  time = NULL,
  maxValues = NULL,
  type = NULL,
  fillColor = NULL,
  colorPalette = d3.schemeCategory10,
  width = NULL,
  height = NULL,
  opacity = NULL,
  showLabels = NULL,
  labelText = NULL,
  labelMinSize = NULL,
  labelMaxSize = NULL,
  labelStyle = NULL,
  transitionTime = NULL,
  popup = NULL,
  legend = TRUE,
  legendPosition = NULL,
  timeFormat = NULL,
  initialTime = NULL,
  onChange = NULL,
  popupOptions = NULL
)

removeMinicharts(map, layerId)

clearMinicharts(map)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>map</code></td>
<td>
<p>A leaflet map object created with <code>leaflet</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lng</code></td>
<td>
<p>Longitude where to place the charts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>Latitude where to place the charts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chartdata</code></td>
<td>
<p>A numeric matrix with number of rows equal to the number of
elements in <code>lng</code> or <code>lat</code> and number of column equal to the
number of variables to represent. If parameter <code>time</code> is set, the
number of rows must be equal to the length of <code>lng</code> times the number
of unique time steps in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>A vector with length equal to the number of rows in <code>chartdata</code>
and containing either numbers representing time indices or dates or
datetimes. Each unique value must appear as many times as the others. This
parameter can be used when one wants to represent the evolution of some
variables on a map.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxValues</code></td>
<td>
<p>maximal absolute values of the variables to represent.
It can be a vector with one value per column of <code>chartdata</code> or a single
value. Using a single value enforces charts to use a unique scale for all
variables. If it is <code>NULL</code>, the maximum value of <code>chartdata</code> is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of chart. Possible values are <code>"bar"</code> for bar charts,
<code>"pie"</code> for pie charts, <code>"polar-area"</code> and <code>"polar-radius"</code>
for polar area charts where the values are represented respectively by the
area or the radius of the slices. Finally it can be equal to <code>"auto"</code>,
the default. In this case, if there is only one variable to represent, the
chart will be a single circle, else it is a barchart.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fillColor</code></td>
<td>
<p>Used only if data contains only one column. It is the color
used to fill the circles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colorPalette</code></td>
<td>
<p>Color palette to use when <code>chartdata</code> contains more than
one column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>maximal width of the created elements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>height</code></td>
<td>
<p>maximal height of the created elements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opacity</code></td>
<td>
<p>Opacity of the chart.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showLabels</code></td>
<td>
<p>Should values be displayed above chart elements.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelText</code></td>
<td>
<p>character vector containing the text content of the charts.
Used only if <code>chartdata</code> contains only one column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelMinSize</code></td>
<td>
<p>Minimal height of labels in pixels. When there is not
enough space for labels, they are hidden.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelMaxSize</code></td>
<td>
<p>Maximal height of labels in pixels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelStyle</code></td>
<td>
<p>Character string containing CSS properties to apply to the
labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transitionTime</code></td>
<td>
<p>Duration in milliseconds of the transitions when a
property of a chart is updated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popup</code></td>
<td>
<p>Options that control popup generation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>layerId</code></td>
<td>
<p>An ID variable. It is mandatory when one wants to update some
chart with <code>updateMinicharts</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>If TRUE and if data has column names, then a legend is
automatically added to the map.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendPosition</code></td>
<td>
<p>Where should legend be placed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeFormat</code></td>
<td>
<p>Character string used to format dates and times when
argument <code>time</code> is a <code>Date</code>, <code>POSIXct</code> or <code>POSIXlt</code>
object. See <code>strptime</code> for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initialTime</code></td>
<td>
<p>This argument can be used to set the initial time step
shown when the map is created. It is used only when argument <code>time</code> is
set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>onChange</code></td>
<td>
<p>(For power users who know javascript) A character string
containing javascript code that is executed each time a chart is updated.
See the details section to understand why and how to use this parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popupOptions</code></td>
<td>
<p>Change default popupOptions (ex : autoClose, maxHeight, closeButton ...)
See <code>popupOptions</code> for more informations.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Since version 0.5, the parameter <code>onChange</code> can be used to execute
some arbitrary javascript code each time a chart is updated (with
<code>updateMinicharts()</code> or when time step changes). A typical use case
would be to change the color of a polygon added with
<code>addPolygons</code> based on the data of the chart. It is even
possible to create an invisible chart and use it to manage the color and the
popup of a polygon. Here is a sample code that do that:
</p>
<pre>
  leaflet() %&gt;% addTiles() %&gt;%
    addPolygons(data = myPolygons, layerId = myPolygons$myIds) %&gt;%
    addMinicharts(
      mydata$lon, mydata$lat,
      time = mydata$time
      fillColor = mydata$color,
      layerId = mydata$myIds,
      width = 0, height = 0,
      onChange = "
        var s = this._map.layerManager.getLayer("shape", this.layerId);
        s.bindPopup(popup);
        if (opts.fillColor) {
          d3.select(s._path)
          .transition()
          .duration(750)
          .attr("fill", opts.fillColor);
        }"
    )

</pre>
<p>The following objects are available when executing the javascript code:
</p>

<dl>
<dt>this</dt>
<dd>
<p>The current minichart object. See
<a href="https://rte-antares-rpackage.github.io/leaflet.minichart/-_L.Minichart_.html">https://rte-antares-rpackage.github.io/leaflet.minichart/-_L.Minichart_.html</a>
for more information.
</p>
</dd>
<dt>opts</dt>
<dd>
<p>The current options passed to the current minichart object.</p>
</dd>
<dt>popup</dt>
<dd>
<p>Popup html.</p>
</dd>
<dt>d3</dt>
<dd>
<p>The D3 module.</p>
</dd>
</dl>
<p>Here is a toy example
</p>


<h3>Value</h3>

<p>The modified leaflet map object. <code>addMinicharts</code> add new minicharts to
the map. <code>updateMinicharts</code> updates minicharts that have already been
added to the map. <code>removeMinicharts</code> removes some specific charts from
the map and <code>clearMinicharts</code> removes all charts from the map and
if necessary the legend that has been automatically created.
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(leaflet)
mymap &lt;- leaflet() %&gt;% addTiles() %&gt;% addMinicharts(0, 0, chartdata = 1:3, layerId = "c1")

mymap
mymap %&gt;% updateMinicharts("c1", maxValues = 6)
mymap %&gt;% updateMinicharts("c1", type="pie")

# popupOptions
mymap &lt;- leaflet() %&gt;% addTiles() %&gt;%
  addMinicharts(0, 0, chartdata = 1:3, layerId = "c1", popupOptions = list(closeButton = FALSE))

mymap
mymap %&gt;% updateMinicharts("c1", maxValues = 6, popupOptions = list(closeButton = TRUE))

</code></pre>


</div>